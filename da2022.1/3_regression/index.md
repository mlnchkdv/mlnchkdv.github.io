# [⬅Анализ данных 2022.1](../index.html)

# Линейная регрессия (OLS regression)

Регрессионный анализ является очень широко используемым статистическим инструментом для установления модели отношений между двумя переменными. Одна из этих переменных называется предикторной переменной, значение которой собирается в ходе экспериментов. Другая переменная называется переменной ответа, значение которой получено из переменной предиктора.

В линейной регрессии эти две переменные связаны через уравнение, где показатель (степень) обеих этих переменных равен 1. Математически линейная зависимость представляет прямую линию, когда она изображена в виде графика. Нелинейное отношение, где показатель степени любой переменной не равен 1, создает кривую.

Общее математическое уравнение для линейной регрессии:
$$
y = ax + b
$$
где $y$ - ответ, $x$ - предиктор, $a$ и $b$ - коэффициенты.



## Пример

Простым примером регрессии является прогнозирование веса человека, когда известен его рост. Для этого нам необходимо иметь соотношение между ростом и весом человека.

Шаги для создания отношений:

- Проводят эксперимент по сбору образца наблюдаемых значений роста и соответствующего веса.

> Values of height
> 151, 174, 138, 186, 128, 136, 179, 163, 152, 131
>
> Values of weight
> 63, 81, 56, 91, 47, 57, 76, 72, 62, 48

<iframe src="https://www.desmos.com/calculator/hafqpipbjt?embed" width="500" height="500" style="border: 1px solid #ccc" frameborder=0></iframe>



- Создайте модель отношений между предиктором и переменной ответа, используя функции `lm ()` в R.

Основной синтаксис функции **lm ()** в линейной регрессии:

```R
lm([data], formula)
```

**Формула** представляет собой символ, представляющий отношения между х и у, где слева от знака ~ то что мы хотим предсказать, а справа от знака, то при помощи чего, каких предикторов.

**Данные** — это вектор, к которому будет применена формула.



- Найдите коэффициенты из созданной модели и создайте математическое уравнение, используя их.

```R
x <- c(151, 174, 138, 186, 128, 136, 179, 163, 152, 131)
y <- c(63, 81, 56, 91, 47, 57, 76, 72, 62, 48)

relation <- lm(y~x)

print(summary(relation))
```

> Call:
> lm(formula = y ~ x)
>
> Coefficients:
> (Intercept)            x  
>    -38.4551          0.6746 

$$
y = 0.67x - 38.45
$$

<iframe src="https://www.desmos.com/calculator/ngp7qh5wer?embed" width="500" height="500" style="border: 1px solid #ccc" frameborder=0></iframe>



- Получите сводную информацию о модели отношений, чтобы узнать среднюю ошибку в прогнозировании. Также называется **остатками**.

> Call:
> lm(formula = y ~ x)
>
> Residuals:
>     Min     	 1Q     	Median      3Q     	Max 
> -6.3002    -1.6629  	0.0412    1.8944    3.9775 
>
> Coefficients:
>              		Estimate 	Std. Error t value 	Pr(>|t|)    
> (Intercept) -38.45509    8.04901  	-4.778  	0.00139 ** 
>
> x             		0.67461     0.05191  	12.997 	 1.16e-06 ***
>
> Signif. codes:  0 ‘$***$’ 0.001 ‘$**$’ 0.01 ‘$*$’ 0.05 ‘.’ 0.1 ‘ ’ 1
>
> Residual standard error: 3.253 on 8 degrees of freedom
> Multiple R-squared:  0.9548,    Adjusted R-squared:  0.9491 
> F-statistic: 168.9 on 1 and 8 DF,  p-value: 1.164e-06



- Чтобы предсказать вес новых людей, используйте функцию `predict()` в R.

```R
predict(object, newdata)
```

**Объект** — это формула, которая уже создана с помощью функции `lm()`.

**newdata** — это вектор, содержащий новое значение переменной-предиктора.

```R
x <- c(151, 174, 138, 186, 128, 136, 179, 163, 152, 131)
y <- c(63, 81, 56, 91, 47, 57, 76, 72, 62, 48)

relation <- lm(y~x)

a <- data.frame(x = 170)
result <-  predict(relation, a)
print(result)
```

> ​			  1 
>
> 76.22869 

$$
76.22869 = 0.67461*170-38.45509
$$

<iframe src="https://www.desmos.com/calculator/8mqxbkuvgd?embed" width="500" height="500" style="border: 1px solid #ccc" frameborder=0></iframe>

https://www.desmos.com/calculator/8mqxbkuvgd



# Множественная регрессия

Множественная регрессия является продолжением линейной регрессии в связи между более чем двумя переменными. В простом линейном отношении у нас есть один предиктор и одна переменная ответа, но в множественной регрессии мы имеем более одной переменной предиктора и одну переменную ответа.

Общее математическое уравнение множественной регрессии:
$$
y = a + b_1 x_1 + b_2 x_2 +...b_n x_n
$$
где $y$ - ответ, $a, b_1, ...b_n$ - коэффициенты, $x_1,...,x_n$ - предикторы.

Аналогично линейной регрессии создаем регрессионную модель, используя функцию `lm()` в R. Модель определяет значение коэффициентов, используя входные данные. Затем мы можем предсказать значение переменной отклика для данного набора переменных предиктора, используя эти коэффициенты.

```R
lm(y ~ x1 + x2 + x3..., data)
```



## Пример

Рассмотрим набор данных «mtcars», доступный в среде R. Сравнивая между собой различные модели автомобилей с точки зрения пробега на галлон (миль на галлон), рабочего объема цилиндра («disp»), лошадиных сил («л.с.»), веса автомобиля («wt») и некоторых других параметров.

Цель модели — установить связь между «mpg» в качестве переменной отклика с «disp», «hp» и «wt» в качестве переменных-предикторов. Для этого мы создаем подмножество этих переменных из набора данных mtcars.

```R
input <- mtcars[,c("mpg","disp","hp","wt")]
print(head(input))
```

>  										mpg   disp   hp    wt
> Mazda RX4          		 21.0	160    110   2.620
> Mazda RX4 Wag    	  21.0    160    110   2.875
> Datsun 710         		 22.8    108     93   2.320
> Hornet 4 Drive       	21.4     258    110   3.215
> Hornet Sportabout   18.7     360    175   3.440
> Valiant            			 18.1     225    105   3.460

Создадим модель отношений и получим коэффициенты:

```R
input <- mtcars[,c("mpg","disp","hp","wt")]

model <- lm(mpg ~ disp + hp + wt, data = input)

print(model)

cat("The Coefficient Values ","\n")

a <- coef(model)[1]
print(a)

Xdisp <- coef(model)[2]
Xhp <- coef(model)[3]
Xwt <- coef(model)[4]

print(Xdisp)
print(Xhp)
print(Xwt)
```

> Call:
> lm(formula = mpg ~ disp + hp + wt, data = input)
>
> Coefficients:
> (Intercept)         disp           	hp          	 wt  
>   37.105505      -0.000937        -0.031157    -3.800891  
>
> The Coefficient Values
>
> (Intercept) 
>    37.10551 
>          		disp 
> -0.0009370091 
>          	hp 
> -0.03115655 
>        wt 
> -3.800891 

На основе приведенных выше значений пересечения и коэффициентов мы создадим уравнение множественной регресси:
$$
y = 37.15 - 0.000937 * x_1 - 0.0311 * x_2 - 3.8008 * x_3
$$
или 

```R
# y = 37.15 + (-0.000937)*x1 + (-0.0311)*x2 + (-3.8008)*x3
y = a + Xdisp*x1 + Xhp*x2 + Xwt*x3
```

Теперь можно использовать уравнение регрессии, созданное выше, для прогнозирования пробега, для нового набора значений. Так, для автомобиля с disp = 221, hp = 102 и wt = 2,91 прогнозируемый пробег составит:

